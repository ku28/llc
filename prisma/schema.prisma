generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id               Int               @id @default(autoincrement())
  email            String?           @unique
  name             String?
  passwordHash     String?
  role             String            @default("staff")
  createdAt        DateTime          @default(now())
  profileImage     String?
  verified         Boolean           @default(false)
  phone            String?           @unique
  patients         Patient[]         @relation("DoctorPatients")
  visits           Visit[]           @relation("DoctorVisits")
  treatments       Treatment[]       @relation("DoctorTreatments")
  prescriptions    Prescription[]    @relation("DoctorPrescriptions")
  customerInvoices CustomerInvoice[] @relation("DoctorInvoices")
  products         Product[]         @relation("DoctorProducts")
  categories       Category[]        @relation("DoctorCategories")
  suppliers        Supplier[]        @relation("DoctorSuppliers")
  purchaseOrders   PurchaseOrder[]   @relation("DoctorPurchaseOrders")
  tasksAssignedTo  Task[]            @relation("TasksAssignedTo")
  tasksAssignedBy  Task[]            @relation("TasksAssignedBy")
  doctorTasks      Task[]            @relation("DoctorTasks")
}

model PendingUser {
  id                Int      @id @default(autoincrement())
  email             String   @unique
  name              String?
  passwordHash      String?
  role              String   @default("staff")
  verificationToken String   @unique
  createdAt         DateTime @default(now())
  expiresAt         DateTime
  profileImage      String?
}

model OTP {
  id         Int      @id @default(autoincrement())
  identifier String   @unique
  otp        String
  name       String?
  createdAt  DateTime @default(now())
  expiresAt  DateTime
}

model Patient {
  id                        Int               @id @default(autoincrement())
  firstName                 String
  lastName                  String?
  phone                     String?
  email                     String?           @unique
  date                      DateTime?         @default(now())
  dob                       DateTime?
  age                       Int?
  address                   String?
  gender                    String?
  nextVisit                 DateTime?
  fatherHusbandGuardianName String?
  createdAt                 DateTime          @default(now())
  imageUrl                  String?
  temperament               String?
  pulseDiagnosis            String?
  pulseDiagnosis2           String?
  majorComplaints           String?
  historyReports            String?
  investigations            String?
  provisionalDiagnosis      String?
  improvements              String?
  doctorId                  Int?
  appointments              Appointment[]
  customerInvoices          CustomerInvoice[]
  invoices                  Invoice[]
  visits                    Visit[]
  tokens                    Token[]
  doctor                    User?             @relation("DoctorPatients", fields: [doctorId], references: [id])

  @@index([doctorId])
}

model Token {
  id          Int      @id @default(autoincrement())
  patientId   Int
  tokenNumber Int
  date        DateTime
  status      String   @default("waiting")
  createdAt   DateTime @default(now())
  patient     Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade)

  @@index([date, tokenNumber])
}

model Appointment {
  id        Int      @id @default(autoincrement())
  patientId Int
  scheduled DateTime
  notes     String?
  status    String   @default("scheduled")
  createdAt DateTime @default(now())
  patient   Patient  @relation(fields: [patientId], references: [id])
}

model AppointmentRequest {
  id            Int      @id @default(autoincrement())
  userId        Int
  userName      String
  userEmail     String
  userPhone     String
  message       String?
  status        String   @default("pending")
  patientId     Int?
  appointmentId Int?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Invoice {
  id         Int       @id @default(autoincrement())
  patientId  Int
  totalCents Int
  paid       Boolean   @default(false)
  dueDate    DateTime?
  createdAt  DateTime  @default(now())
  patient    Patient   @relation(fields: [patientId], references: [id])
}

model Product {
  id                   Int                   @id @default(autoincrement())
  name                 String
  priceRupees          Float
  quantity             Int                   @default(0)
  actualInventory      Int?
  inventoryValue       Float?
  latestUpdate         DateTime?
  purchasePriceRupees  Float                 @default(0)
  purchaseValue        Float?
  salesValue           Float?
  totalPurchased       Int                   @default(0)
  totalSales           Int                   @default(0)
  unit                 String?
  categoryId           Int?
  doctorId             Int?
  customerInvoiceItems CustomerInvoiceItem[]
  demandForecasts      DemandForecast[]
  prescriptions        Prescription[]
  category             Category?             @relation(fields: [categoryId], references: [id])
  doctor               User?                 @relation("DoctorProducts", fields: [doctorId], references: [id])
  batches              ProductBatch[]
  productOrders        ProductOrder[]
  purchaseOrderItems   PurchaseOrderItem[]
  stockTransactions    StockTransaction[]
  treatmentProducts    TreatmentProduct[]

  @@index([doctorId])
}

model Category {
  id           Int       @id @default(autoincrement())
  name         String
  code         String?
  createdAt    DateTime  @default(now())
  reorderLevel Int       @default(0)
  doctorId     Int?
  products     Product[]
  doctor       User?     @relation("DoctorCategories", fields: [doctorId], references: [id])

  @@unique([name, doctorId])
  @@index([doctorId])
}

model Treatment {
  id                Int                @id @default(autoincrement())
  dosage            String?
  administration    String?
  procedure         String?
  notes             String?
  createdAt         DateTime           @default(now())
  additions         String?
  diseaseAction     String?
  organ             String?
  presentation      String?
  provDiagnosis     String?
  speciality        String?
  srNo              String?
  timing            String?
  treatmentPlan     String?
  planNumber        String?
  deleted           Boolean?           @default(false)
  doctorId          Int?
  prescriptions     Prescription[]
  treatmentProducts TreatmentProduct[]
  doctor            User?              @relation("DoctorTreatments", fields: [doctorId], references: [id])

  @@unique([provDiagnosis, planNumber])
  @@index([doctorId])
}

model TreatmentProduct {
  id               Int       @id @default(autoincrement())
  treatmentId      Int
  productId        Int
  spy1             String?
  spy2             String?
  spy3             String?
  spy4             String?
  spy5             String?
  spy6             String?
  createdAt        DateTime  @default(now())
  addition1        String?
  addition2        String?
  addition3        String?
  dosage           String?
  presentation     String?
  procedure        String?
  timing           String?
  bottleSize       String?
  product          Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  treatment        Treatment @relation(fields: [treatmentId], references: [id], onDelete: Cascade)

  @@unique([treatmentId, productId])
}

model Visit {
  id                   Int            @id @default(autoincrement())
  patientId            Int
  opdNo                String
  date                 DateTime       @default(now())
  diagnoses            String?
  temperament          String?
  pulseDiagnosis       String?
  pulseDiagnosis2      String?
  majorComplaints      String?
  historyReports       String?
  investigations       String?
  provisionalDiagnosis String?
  improvements         String?
  specialNote          String?
  initials             String?
  dob                  DateTime?
  age                  Int?
  address              String?
  visitNumber          Int?
  followUpCount        Int?
  gender               String?
  phone                String?
  nextVisit            DateTime?
  occupation           String?
  pendingPaymentCents  Int            @default(0)
  height               Float?
  weight               Float?
  procedureAdopted     String?
  precautions          String?
  discussion           String?
  extra                String?
  amount               Float?
  discount             Float?
  payment              Float?
  balance              Float?
  helper               String?
  reportsAttachments   String?           @db.Text
  patientCopyPdfUrl    String?           @db.Text
  officeCopyPdfUrl     String?           @db.Text
  isImported           Boolean           @default(false)
  createdAt            DateTime          @default(now())
  doctorId             Int?
  prescriptions        Prescription[]
  patient              Patient           @relation(fields: [patientId], references: [id])
  doctor               User?             @relation("DoctorVisits", fields: [doctorId], references: [id])
  invoice              CustomerInvoice?
  tasks                Task[]

  @@index([doctorId])
}

model Prescription {
  id               Int        @id @default(autoincrement())
  visitId          Int
  treatmentId      Int?
  dosage           String?
  administration   String?
  quantity         Int        @default(1)
  taken            Boolean    @default(false)
  dispensed        Boolean    @default(false)
  createdAt        DateTime   @default(now())
  spy1             String?
  spy2             String?
  spy3             String?
  spy4             String?
  spy5             String?
  spy6             String?
  addition1        String?
  addition2        String?
  addition3        String?
  droppersToday    Int?
  medicineQuantity Int?
  presentation     String?
  procedure        String?
  productId        Int?
  timing           String?
  doctorId         Int?
  product          Product?   @relation(fields: [productId], references: [id])
  treatment        Treatment? @relation(fields: [treatmentId], references: [id])
  visit            Visit      @relation(fields: [visitId], references: [id])
  doctor           User?      @relation("DoctorPrescriptions", fields: [doctorId], references: [id])

  @@index([doctorId])
}

model ProductBatch {
  id                 Int        @id @default(autoincrement())
  productId          Int
  sku                String?
  quantity           Int
  purchasePriceRupees Float
  salePriceRupees     Float
  expiry             DateTime?
  createdAt          DateTime   @default(now())
  product            Product    @relation(fields: [productId], references: [id])
  purchases          Purchase[]
  sales              Sale[]
}

model Purchase {
  id             Int          @id @default(autoincrement())
  productBatchId Int
  quantity       Int
  totalCents     Int
  supplier       String?
  date           DateTime     @default(now())
  productBatch   ProductBatch @relation(fields: [productBatchId], references: [id])
}

model Sale {
  id             Int          @id @default(autoincrement())
  productBatchId Int
  quantity       Int
  totalCents     Int
  customer       String?
  date           DateTime     @default(now())
  productBatch   ProductBatch @relation(fields: [productBatchId], references: [id])
}

model ProductOrder {
  id        Int      @id @default(autoincrement())
  productId Int
  quantity  Int
  status    String   @default("pending")
  orderVia  String?
  createdAt DateTime @default(now())
  product   Product  @relation(fields: [productId], references: [id])
}

model Supplier {
  id                 Int             @id @default(autoincrement())
  name               String
  contactPerson      String?
  email              String?
  phone              String?
  address            String?
  city               String?
  state              String?
  pincode            String?
  gstin              String?
  paymentTerms       String          @default("Net 30")
  creditLimit        Int             @default(0)
  outstandingBalance Int             @default(0)
  status             String          @default("active")
  notes              String?
  createdAt          DateTime        @default(now())
  updatedAt          DateTime        @updatedAt
  doctorId           Int?
  purchaseOrders     PurchaseOrder[]
  doctor             User?           @relation("DoctorSuppliers", fields: [doctorId], references: [id])

  @@index([doctorId])
}

model PurchaseOrder {
  id           Int                 @id @default(autoincrement())
  poNumber     String              @unique
  supplierId   Int
  orderDate    DateTime            @default(now())
  expectedDate DateTime?
  receivedDate DateTime?
  status       String              @default("pending")
  subtotal     Int                 @default(0)
  taxAmount    Int                 @default(0)
  discount     Int                 @default(0)
  shippingCost Int                 @default(0)
  totalAmount  Int                 @default(0)
  paidAmount   Int                 @default(0)
  notes        String?
  billUrl      String?
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt
  doctorId     Int?
  supplier     Supplier            @relation(fields: [supplierId], references: [id])
  doctor       User?               @relation("DoctorPurchaseOrders", fields: [doctorId], references: [id])
  items        PurchaseOrderItem[]

  @@index([doctorId])
}

model PurchaseOrderItem {
  id               Int           @id @default(autoincrement())
  purchaseOrderId  Int
  productId        Int
  quantity         Int
  unitPrice        Int
  taxRate          Float         @default(0)
  discount         Int           @default(0)
  totalAmount      Int
  receivedQuantity Int           @default(0)
  createdAt        DateTime      @default(now())
  product          Product       @relation(fields: [productId], references: [id])
  purchaseOrder    PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)
}

model CustomerInvoice {
  id                 Int                   @id @default(autoincrement())
  invoiceNumber      String                @unique
  visitId            Int?                  @unique
  patientId          Int?
  customerName       String
  customerEmail      String?
  customerPhone      String?
  customerAddress    String?
  customerGSTIN      String?
  invoiceDate        DateTime              @default(now())
  dueDate            DateTime?
  status             String                @default("unpaid")
  subtotal           Int                   @default(0)
  taxAmount          Int                   @default(0)
  discount           Int                   @default(0)
  totalAmount        Int                   @default(0)
  paidAmount         Int                   @default(0)
  balanceAmount      Int                   @default(0)
  paymentMethod      String?
  notes              String?
  termsAndConditions String?
  createdAt          DateTime              @default(now())
  updatedAt          DateTime              @updatedAt
  doctorId           Int?
  visit              Visit?                @relation(fields: [visitId], references: [id])
  patient            Patient?              @relation(fields: [patientId], references: [id])
  doctor             User?                 @relation("DoctorInvoices", fields: [doctorId], references: [id])
  items              CustomerInvoiceItem[]
  payments           Payment[]

  @@index([doctorId])
}

model CustomerInvoiceItem {
  id                Int             @id @default(autoincrement())
  customerInvoiceId Int
  productId         Int?
  description       String
  quantity          Int
  unitPrice         Float
  taxRate           Float           @default(0)
  discount          Int             @default(0)
  totalAmount       Float
  createdAt         DateTime        @default(now())
  customerInvoice   CustomerInvoice @relation(fields: [customerInvoiceId], references: [id], onDelete: Cascade)
  product           Product?        @relation(fields: [productId], references: [id])
}

model StockTransaction {
  id              Int      @id @default(autoincrement())
  productId       Int
  transactionType String
  quantity        Int
  unitPrice       Float    @default(0)
  totalValue      Float    @default(0)
  balanceQuantity Int
  referenceType   String?
  referenceId     Int?
  notes           String?
  transactionDate DateTime @default(now())
  performedBy     String?
  createdAt       DateTime @default(now())
  product         Product  @relation(fields: [productId], references: [id])
}

model DemandForecast {
  id                     Int      @id @default(autoincrement())
  productId              Int
  forecastMonth          DateTime
  predictedDemand        Int
  actualDemand           Int      @default(0)
  averageMonthlySales    Float    @default(0)
  reorderPoint           Int      @default(0)
  suggestedOrderQuantity Int      @default(0)
  notes                  String?
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  product                Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, forecastMonth])
}

model Payment {
  id              Int             @id @default(autoincrement())
  paymentNumber   String          @unique
  paymentType     String
  referenceType   String
  referenceId     Int
  amount          Float
  paymentMethod   String
  paymentDate     DateTime        @default(now())
  transactionId   String?
  notes           String?
  createdAt       DateTime        @default(now())
  customerInvoice CustomerInvoice @relation(fields: [referenceId], references: [id])
}

// Landing Page Content Models
model LandingHero {
  id            Int      @id @default(autoincrement())
  badge         String
  heading       String
  headingGreen  String   @default("Last Leaf Care")
  tagline       String
  imageUrl      String
  updatedAt     DateTime @updatedAt
  updatedBy     String?
}

model LandingBenefit {
  id          Int      @id @default(autoincrement())
  title       String
  description String   @db.Text
  benefits    Json     // Array of {icon, title, description}
  updatedAt   DateTime @updatedAt
  updatedBy   String?
}

model LandingVideo {
  id        Int      @id @default(autoincrement())
  embedUrl  String
  title     String
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model LandingSpecialist {
  id          Int      @id @default(autoincrement())
  title       String
  description String   @db.Text
  quote       String   @db.Text
  updatedAt   DateTime @updatedAt
  updatedBy   String?
}

model AboutContent {
  id          Int      @id @default(autoincrement())
  title       String
  description String   @db.Text
  quote       String   @db.Text
  updatedAt   DateTime @updatedAt
  updatedBy   String?
}

model ServiceCard {
  id          Int      @id @default(autoincrement())
  image       String
  name        String
  tagline     String
  info        String
  description String   @db.Text
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model GalleryImage {
  id        Int      @id @default(autoincrement())
  imageUrl  String
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model AchievementImage {
  id        Int      @id @default(autoincrement())
  imageUrl  String
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ContactInfo {
  id          Int      @id @default(autoincrement())
  address     String   @db.Text
  phone       String
  email       String
  hours       String   @db.Text
  updatedAt   DateTime @updatedAt
  updatedBy   String?
}

model Task {
  id           Int      @id @default(autoincrement())
  title        String
  description  String?  @db.Text
  type         String   @default("task")
  status       String   @default("pending")
  assignedTo   Int?
  assignedBy   Int?
  doctorId     Int?
  acknowledged Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  completedAt  DateTime?
  isSuggested  Boolean  @default(false)
  expiresAt    DateTime?
  visitId      Int?
  attachmentUrl String? @db.Text

  assignedToUser User? @relation("TasksAssignedTo", fields: [assignedTo], references: [id], onDelete: Cascade)
  assignedByUser User? @relation("TasksAssignedBy", fields: [assignedBy], references: [id], onDelete: Cascade)
  doctor         User? @relation("DoctorTasks", fields: [doctorId], references: [id], onDelete: Cascade)
  visit          Visit? @relation(fields: [visitId], references: [id], onDelete: Cascade)

  @@index([assignedTo])
  @@index([assignedBy])
  @@index([status])
  @@index([isSuggested])
  @@index([visitId])
  @@index([doctorId])
}

